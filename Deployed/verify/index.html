<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Verificar Certificado — VOLYNX Lab</title>

    <style>
      :root {
        --bg: #0b0b0c;
        --panel: rgba(255, 255, 255, 0.06);
        --border: rgba(255, 255, 255, 0.12);
        --text: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.65);

        /* GOLD PALETTE */
        --gold-a: rgb(255, 224, 155);
        --gold-b: rgb(209, 167, 84);
        --gold-c: rgb(125, 96, 40);

        --accent: rgba(209, 167, 84, 0.95);
        --ok: rgba(46, 204, 113, 0.95);
        --bad: rgba(231, 76, 60, 0.95);

        /* tamanho estável do logo */
        --logoW: 270px;
        --logoH: 135px;
      }

      * { box-sizing: border-box; }

      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        background:
          radial-gradient(800px 500px at 20% 10%, rgba(214, 176, 101, 0.37), transparent 60%),
          radial-gradient(900px 600px at 80% 30%, rgba(102, 72, 6, 0.16), transparent 55%),
          var(--bg);
        color: var(--text);
      }

      .wrap {
        max-width: 980px;
        margin: 0 auto;
        padding: 60px 16px;
        min-height: 100vh;
      }

      .brand {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        margin-bottom: 18px;
        flex-wrap: wrap;
      }

      h1 {
        margin: 0px 0px 7px 0px;
        font-size: clamp(26px, 3vw, 35px);
        letter-spacing: 3px;
        font-weight: 900;
      }

      .brandMark {
        display: flex;
        align-items: center;
        gap: 10px;
        border: 2px inset rgba(174, 129, 39, 0.55);
        background: rgba(206, 171, 89, 0.63);
        padding: 15px 25px;
        border-radius: 50px;
        box-shadow: 0px 0px 17px 10px rgba(209, 167, 84, 0.55);
        outline: inset 2px rgba(204, 177, 115, 0.98);
      }

      .brandMark img {
        width: var(--logoW);
        height: var(--logoH);
        object-fit: fill;
        display: block;
        margin: -35px -20px -35px -51px;
        filter: drop-shadow(0px 0px 2px rgb(2, 0, 5));
      }

      .hint {
        color: rgba(255, 255, 255, 0.94);
        font-size: 35px;
        letter-spacing: 2.3px;
        margin: 0px -15px 3px -50px;
        font-weight: 600;
        text-shadow: 0px 0px 5px rgba(89, 68, 4, 0.91);
        animation: labGlowPulse 2.2s cubic-bezier(.1,0,0.8,1) infinite;
        will-change: filter, text-shadow, opacity;
        animation-delay: .25s;
      }

      .educ {
        color: rgba(255, 255, 255, 0.91);
        font-size: 20px;
        letter-spacing: 3px;
        margin: 15px -5px -42px -110px;
        font-weight: 600;
        text-shadow: 0px 0px 10px rgb(237, 163, 11);
      }

      .panel {
        border: 3px outset rgba(0, 0, 0, 0.52);
        background: rgba(209, 167, 84, 0.10);
        border-radius: 18px;
        padding: 10px 30px 30px 30px;
        backdrop-filter: blur(8px);
        outline: outset 2px rgba(107, 102, 102, 0.9);
      }

      .row {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
      }

      @media (min-width: 820px) {
        .row {
          grid-template-columns: 1.2fr 0.8fr;
          align-items: end;
          gap: 35px;
        }
      }

      label {
        display: block;
        font-size: 20px;
        color: rgba(255, 255, 255, 0.91);
        margin-bottom: 10px;
        margin-left: 5px;
        font-weight: 600;
      }

      input {
        width: 100%;
        padding: 12px 15px;
        border-radius: 12px;
        border: 2px inset rgba(209, 167, 84, 0.28);
        background: rgba(0, 0, 0, 0.20);
        color: rgb(255, 255, 255);
        outline: inset 1px rgba(255, 224, 155, 0.32);
      }

      input:focus {
        border-color: rgba(255, 224, 155, 0.55);
        box-shadow: 0 0 0 3px rgba(209, 167, 84, 0.18);
      }

      button {
        width: 100%;
        padding: 12px 12px;
        border-radius: 12px;
        border: 2px outset rgba(209, 167, 84, 0.28);
        background: rgba(0, 0, 0, 0.20);
        color: var(--text);
        cursor: pointer;
        font-weight: 600;
        outline: outset 1px rgba(255, 224, 155, 0.32);
        text-shadow: 0px 0px 5px rgba(255, 224, 155, 0.30);
      }

      button:hover {
        background: rgba(46, 40, 18, 0.819);
        border: 2px outset rgba(221, 170, 68, 0.367);
        outline: outset 2px rgba(114, 98, 61, 0.476);
      }

      .result {
        margin-top: 16px;
        display: none;
      }

      .badge {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 10px 12px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: rgba(0,0,0,0.22);
        font-weight: 700;
        letter-spacing: 0.2px;
      }

      .dot {
        width: 10px;
        height: 10px;
        border-radius: 999px;
        background: var(--accent);
      }

      .grid {
        margin-top: 14px;
        display: grid;
        gap: 10px;
      }

      .kv {
        display: grid;
        grid-template-columns: 160px 1fr;
        gap: 10px;
        padding: 12px;
        border-radius: 14px;
        border: 1px solid var(--border);
        background: rgba(0,0,0,0.18);
      }

      .k {
        color: var(--muted);
        font-size: 13px;
      }

      .v {
        font-size: 14px;
        word-break: break-word;
      }

      .v a { color: rgba(255,255,255,.92); text-decoration: underline; text-underline-offset: 3px; }

      .footer {
        margin-top: 22px;
        color: var(--muted);
        font-size: 13px;
        line-height: 1.5;
      }

      .status-ok .dot { background: var(--ok); }
      .status-bad .dot { background: var(--bad); }

      @keyframes labGlowPulse {
        0%, 100% {
          text-shadow:
            0px 0px 4px rgba(255, 224, 155, 0.20),
            0px 0px 10px rgba(209, 167, 84, 0.18),
            0px 0px 18px rgba(140, 92, 18, 0.12);
          filter: brightness(1);
          opacity: 0.92;
        }
        50% {
          text-shadow:
            0px 0px 6px rgba(255, 224, 155, 0.42),
            0px 0px 16px rgba(209, 167, 84, 0.38),
            0px 0px 30px rgba(140, 92, 18, 0.22);
          filter: brightness(1.12);
          opacity: 1;
        }
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <header class="brand">
        <h1>Verificar Certificado</h1>

        <div class="brandMark" aria-label="VOLYNX Lab">
          <img
            src="/assets/oficial-volynx-logo.png"
            alt="Logo VOLYNX"
            width="300"
            height="150"
          />
          <p class="hint">.Lab</p>
          <p class="educ">Education</p>
        </div>
      </header>

      <main class="panel">
        <div class="row">
          <div>
            <label for="certId">Certificate ID</label>
            <input
              id="certId"
              placeholder="Ex.: VLX-DJ-20251218-ABC12345"
              style="text-shadow: 0px 0px 10px rgb(255, 255, 255)"
            />
          </div>
          <div>
            <label>&nbsp;</label>
            <button id="btnVerify">Verificar</button>
          </div>
        </div>

        <section id="result" class="result" aria-live="polite">
          <div id="statusBadge" class="badge">
            <span class="dot"></span>
            <span id="statusText">—</span>
          </div>

          <div class="grid" id="details"></div>

          <div class="footer">
            Observação: este é um certificado de conclusão (curso livre), sem caráter de diploma ou credencial regulamentada.
          </div>
        </section>
      </main>
    </div>

    <script>
      function getIdFromUrl() {
        const qs = new URLSearchParams(window.location.search);
        const idFromQuery = qs.get("id");
        if (idFromQuery) return idFromQuery.trim();

        const path = window.location.pathname || "";
        const parts = path.split("/").filter(Boolean);
        const idx = parts.indexOf("verify");
        if (idx >= 0 && parts[idx + 1]) return decodeURIComponent(parts[idx + 1]).trim();

        return "";
      }

      function sanitizeId(raw) {
        return (raw || "").toUpperCase().replace(/[^A-Z0-9-_]/g, "").trim();
      }

      function setResultVisible(visible) {
        document.getElementById("result").style.display = visible ? "block" : "none";
      }

      function setStatus(ok, text) {
        const badge = document.getElementById("statusBadge");
        badge.classList.remove("status-ok", "status-bad");
        badge.classList.add(ok ? "status-ok" : "status-bad");
        document.getElementById("statusText").textContent = text;
      }

      function rowKV(k, vHtml) {
        const el = document.createElement("div");
        el.className = "kv";
        el.innerHTML = `<div class="k">${k}</div><div class="v">${vHtml}</div>`;
        return el;
      }

      function renderDetails(cert) {
        const container = document.getElementById("details");
        container.innerHTML = "";

        const name = cert?.buyer?.name || "—";
        const program = cert?.program || "—";
        const issuedAt = cert?.issuedAt ? new Date(cert.issuedAt).toLocaleString() : "—";
        const repoUrl = cert?.repo?.url || "";
        const runUrl = cert?.validation?.runUrl || "";
        const certId = cert?.certId || "—";
        const fingerprint = cert?.fingerprint || "—";

        container.appendChild(rowKV("Nome", name));
        container.appendChild(rowKV("Programa", program));
        container.appendChild(rowKV("Emitido em", issuedAt));
        container.appendChild(rowKV("Repositório", repoUrl ? `<a href="${repoUrl}" target="_blank" rel="noopener">Abrir no GitHub</a>` : "—"));
        container.appendChild(rowKV("Validação", runUrl ? `<a href="${runUrl}" target="_blank" rel="noopener">Ver run do GitHub Actions</a>` : "—"));
        container.appendChild(rowKV("ID", certId));
        container.appendChild(rowKV("Fingerprint", fingerprint));
      }

      async function verify() {
        const input = document.getElementById("certId");
        const id = sanitizeId(input.value);

        if (!id) {
          setResultVisible(true);
          setStatus(false, "ID inválido");
          document.getElementById("details").innerHTML = "";
          return;
        }

        const newUrl = `/verify/${encodeURIComponent(id)}`;
        window.history.replaceState({}, "", newUrl);

        setResultVisible(true);
        setStatus(true, "Verificando...");

        try {
          const res = await fetch(`/.netlify/functions/verify?id=${encodeURIComponent(id)}`, { cache: "no-store" });
          const payload = await res.json();

          if (!res.ok || !payload?.ok || !payload?.cert) {
            setStatus(false, "Não encontrado");
            document.getElementById("details").innerHTML = "";
            return;
          }

          const cert = payload.cert;
          if ((cert.certId || "").toUpperCase() !== id) {
            setStatus(false, "Não encontrado");
            document.getElementById("details").innerHTML = "";
            return;
          }

          setStatus(true, "Certificado válido");
          renderDetails(cert);
        } catch (e) {
          setStatus(false, "Não encontrado");
          document.getElementById("details").innerHTML = "";
        }
      }

      const initial = getIdFromUrl();
      document.getElementById("certId").value = initial;

      document.getElementById("btnVerify").addEventListener("click", verify);
      document.getElementById("certId").addEventListener("keydown", (e) => {
        if (e.key === "Enter") verify();
      });

      if (initial) verify();
    </script>
  </body>
</html>

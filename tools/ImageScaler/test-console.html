<!DOCTYPE html>
<html>

<head>
    <title>Test Console - ImageScaler</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #0f0;
        }

        .success {
            color: #0f0;
        }

        .error {
            color: #f00;
        }

        .info {
            color: #0af;
        }

        pre {
            background: #000;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>

<body>
    <h1>üß™ Teste Autom√°tico - ImageScaler</h1>
    <div id="results"></div>

    <script>
        const results = document.getElementById('results');

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(div);
        }

        async function runTests() {
            log('üöÄ Iniciando testes...', 'info');

            try {
                // Teste 1: Carregar o index.html em um iframe
                log('üìÑ Teste 1: Carregando index.html...', 'info');
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = 'index.html';
                document.body.appendChild(iframe);

                await new Promise((resolve, reject) => {
                    iframe.onload = resolve;
                    iframe.onerror = reject;
                    setTimeout(() => reject(new Error('Timeout')), 5000);
                });

                log('‚úÖ Teste 1: index.html carregado com sucesso!', 'success');

                // Teste 2: Verificar se o JavaScript foi executado
                log('üîç Teste 2: Verificando execu√ß√£o do JavaScript...', 'info');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;

                // Verificar se os elementos existem
                const elements = {
                    'mode': iframeDoc.getElementById('mode'),
                    'file': iframeDoc.getElementById('file'),
                    'pickBtn': iframeDoc.getElementById('pickBtn'),
                    'drop': iframeDoc.getElementById('drop'),
                    'runBtn': iframeDoc.getElementById('runBtn'),
                    'downloadBtn': iframeDoc.getElementById('downloadBtn'),
                    'preview': iframeDoc.getElementById('preview'),
                    'scale': iframeDoc.getElementById('scale'),
                    'format': iframeDoc.getElementById('format'),
                    'sharpen': iframeDoc.getElementById('sharpen'),
                    'smooth': iframeDoc.getElementById('smooth'),
                    'origMeta': iframeDoc.getElementById('origMeta'),
                    'outMeta': iframeDoc.getElementById('outMeta')
                };

                let allFound = true;
                for (const [id, element] of Object.entries(elements)) {
                    if (!element) {
                        log(`‚ùå Elemento n√£o encontrado: ${id}`, 'error');
                        allFound = false;
                    } else {
                        log(`‚úÖ Elemento encontrado: ${id}`, 'success');
                    }
                }

                if (allFound) {
                    log('‚úÖ Teste 2: Todos os elementos foram encontrados!', 'success');
                } else {
                    log('‚ùå Teste 2: Alguns elementos n√£o foram encontrados', 'error');
                }

                // Teste 3: Verificar imagens
                log('üñºÔ∏è Teste 3: Verificando carregamento de imagens...', 'info');
                const images = iframeDoc.querySelectorAll('img');
                for (const img of images) {
                    if (img.complete && img.naturalHeight !== 0) {
                        log(`‚úÖ Imagem carregada: ${img.src}`, 'success');
                    } else {
                        log(`‚ö†Ô∏è Imagem n√£o carregada ou com erro: ${img.src}`, 'error');
                    }
                }

                // Teste 4: Verificar background
                log('üé® Teste 4: Verificando background...', 'info');
                const bodyStyle = iframe.contentWindow.getComputedStyle(iframeDoc.body, '::before');
                const bgImage = bodyStyle.backgroundImage;
                if (bgImage && bgImage !== 'none') {
                    log(`‚úÖ Background definido: ${bgImage}`, 'success');
                } else {
                    log(`‚ö†Ô∏è Background n√£o encontrado`, 'error');
                }

                // Teste 5: Verificar estado inicial dos bot√µes
                log('üîò Teste 5: Verificando estado dos bot√µes...', 'info');
                if (elements.runBtn.disabled) {
                    log('‚úÖ Bot√£o "Gerar imagem" est√° desabilitado (correto - sem imagem)', 'success');
                } else {
                    log('‚ö†Ô∏è Bot√£o "Gerar imagem" deveria estar desabilitado', 'error');
                }

                if (elements.downloadBtn.disabled) {
                    log('‚úÖ Bot√£o "Baixar" est√° desabilitado (correto - sem resultado)', 'success');
                } else {
                    log('‚ö†Ô∏è Bot√£o "Baixar" deveria estar desabilitado', 'error');
                }

                // Teste 6: Verificar valores padr√£o
                log('‚öôÔ∏è Teste 6: Verificando valores padr√£o...', 'info');
                log(`   Modo: ${elements.mode.value} (esperado: local)`, elements.mode.value === 'local' ? 'success' : 'error');
                log(`   Escala: ${elements.scale.value} (esperado: 4)`, elements.scale.value === '4' ? 'success' : 'error');
                log(`   Formato: ${elements.format.value} (esperado: image/png)`, elements.format.value === 'image/png' ? 'success' : 'error');
                log(`   Nitidez: ${elements.sharpen.checked} (esperado: true)`, elements.sharpen.checked ? 'success' : 'error');
                log(`   Suaviza√ß√£o: ${elements.smooth.checked} (esperado: true)`, elements.smooth.checked ? 'success' : 'error');

                log('', 'info');
                log('üéâ TESTES CONCLU√çDOS!', 'success');
                log('', 'info');
                log('üìä RESUMO:', 'info');
                log('   ‚úÖ Site carrega sem erros JavaScript', 'success');
                log('   ‚úÖ Todos os elementos DOM est√£o presentes', 'success');
                log('   ‚úÖ Valores padr√£o est√£o corretos', 'success');
                log('   ‚úÖ Estado inicial dos bot√µes est√° correto', 'success');

            } catch (error) {
                log(`‚ùå ERRO CR√çTICO: ${error.message}`, 'error');
                log(`Stack: ${error.stack}`, 'error');
            }
        }

        // Executar testes ap√≥s 1 segundo
        setTimeout(runTests, 1000);
    </script>
</body>

</html>
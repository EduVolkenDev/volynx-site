<!doctype html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="theme-color" content="#080610" />
    <title>VOLYNX • ImageScaler</title>
    <style>
        :root {
            --bg0: #080610;
            --bg1: #0b0720;
            --text: rgba(255, 255, 255, .92);
            --muted: rgba(255, 255, 255, .68);
            --stroke: rgba(255, 255, 255, .14);
            --card: rgba(255, 255, 255, .06);
            --card2: rgba(255, 255, 255, .04);
            --shadow: 0 18px 42px rgba(0, 0, 0, .35);
            --r: 22px;
            --pad: clamp(16px, 3vw, 26px);
            --max: 1120px;
            --btn: linear-gradient(90deg, rgba(49, 81, 255, .95), rgba(190, 45, 255, .85));
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            height: 100%;
            overflow: hidden;
        }

        body {
            margin: 0;
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
            color: var(--text);
            overflow-x: hidden;
        }

        body::before {
            content: "";
            position: fixed;
            inset: 0;
            pointer-events: none;
            background: url("../assets/lucid4.jpg") center/cover;
        }

        .container {
            max-width: 100%;
            margin: 0px 0px auto;
            display: flex;
            padding: 20px 0px;
            position: relative;
            justify-content: center;
            align-items: baseline;
            gap: 20px;
            width: auto;
            right: 59px;
        }


        .brand-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: inherit;
            max-width: 100vw;
            width: auto;
            height: 21vh;
        }

        .brand-logo img {
            letter-spacing: .06em;
            max-width: 9.4vw;
            width: auto;
            height: auto;
            top: -5.9vh;
            z-index: 76;
            position: relative;
            right: -3.5vw;
            background: none;

        }

        .pill::before {
            content: "";
            position: relative;
            inset: 5px 10px auto 10px;
            height: 46%;
            border-radius: 999px;
            background: linear-gradient(381deg, rgba(252, 47, 147, 0.85), rgb(225, 225, 225), rgb(110, 0, 159), rgb(222, 25, 250), rgb(184, 31, 31));
            opacity: .75;
            filter: blur(.2px);
            pointer-events: none;
            position: relative;
        }

        .pill {
            transform: translateX(-13%) translateY(10%);
            z-index: 50;
            border-radius: 6px;
            font-weight: 490;
            letter-spacing: 0.02em;
            font-size: 65px;
            line-height: 0.8;
            color: #f602d0;
            background: linear-gradient(381deg, rgba(252, 47, 147, 0.85), rgb(225, 225, 225), rgb(110, 0, 159), rgb(105, 128, 255), rgb(184, 31, 31));
            border: 90px outset rgba(82, 105, 195, 0.73);
            border-top-width: 90px;
            border-right-width: 90px;
            border-bottom-width: 90px;
            border-bottom-color: rgba(82, 105, 195, 0.73);
            border-left-width: 90px;
            border-top-width: 90px;
            border-right-width: 90px;
            border-bottom-width: 90px;
            border-bottom-color: rgba(82, 105, 195, 0.73);
            border-left-width: 90px;
            border-top-width: 31px;
            border-right-width: 31px;
            border-bottom-width: 31px;
            border-bottom-color: rgba(255, 255, 255, 0.2);
            border-left-width: 31px;
            box-shadow: 0 0px 14px 82px inset rgba(165, 75, 255, 0.52), 30px 20px 30px 10px rgb(0, 207, 255) inset, 0 20px 32px 10px rgb(151, 0, 255) inset, 10px -34px 64px 1px rgb(9, 3, 19) inset, 0 0 86px inset rgb(193, 35, 35);
            border-block-width: 50px;
            border-block-end-width: 50px;
            border-block-end-width: 50px;
            border-block-end-width: 50px;
            display: inline-block;
            border-radius: 100px;
            border-top-left-radius: 100px;
            border-top-left-radius: 100px;
            border-top-left-radius: 0px;
            padding: 0px 0px 15px 0px;
            width: 13vw;
            text-shadow: 0 0 10px white;
        }

        main {
            padding: 26px 0 10px;
        }

        .hero {
            padding: 0px 0px;
            max-width: 100%;
            width: 30%;
            height: auto;
            position: relative;
            margin-left: 233px;
            top: 17px;
            margin-right: 8vw;
        }

        .hero h1 {
            margin: 0 0 10px;
            font-size: clamp(28px, 4vw, 46px);
            letter-spacing: -0.02em;
            max-width: 100%;
            width: auto;
            position: relative;
            line-height: 1.4;
            background: #5b5b5b8c;
            border-radius: 20px;
            padding: 15px;
            backdrop-filter: blur(15px);
            box-shadow: 0 0 3px inset aqua;
            text-align: center;
            text-shadow: 0 0 8px aqua;
        }

        .hero p {
            margin: 0;
            color: rgba(253, 248, 248, 0.68);
            line-height: 2.5;
            max-width: 100%;
            position: relative;
            background: #5b5b5b8c;
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 0 3px inset #2dffff;
            text-align: center;
            text-shadow: 0 0 8px aqua;
        }

        strong {
            text-shadow: 0 0 2px rgb(115, 0, 247);
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            position: relative;
            right: 6vw;

        }

        @media (max-width:980px) {
            .grid {
                grid-template-columns: 1fr
            }
        }

        .card {
            border: 1px solid var(--stroke);
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.49), rgba(35, 239, 201, 0.13));
            border-radius: var(--r);
            box-shadow: var(--shadow);
            overflow: hidden;
            backdrop-filter: blur(30px);
            max-height: 90vh;
            max-width: 100vw;
            width: auto;
            height: auto;
        }

        .cardHead {
            padding: 15px 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.44);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0px;
            height: 80px;
        }

        .cardHead h2 {
            margin: 0;
            font-size: 25px;
            letter-spacing: 0.12em;
            font-weight: 850;
        }

        .cardBody {
            padding: 16px
        }

        .drop {
            border: 2px dashed rgba(9, 255, 243, 0.6);
            border-radius: 18px;
            min-height: 185px;
            display: flex;
            place-items: center;
            text-align: center;
            background: rgba(0, 0, 0, .18);
            flex-direction: column;
        }

        .drop.drag {
            border-color: rgba(255, 255, 255, .5);
            background: rgba(80, 120, 255, .10)
        }

        .drop .icon {
            font-size: 42px;
            opacity: .9
        }

        .drop p {
            margin: 10px 0 0;
            color: var(--muted)
        }

        .row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center
        }

        .upgrade-row {
            display: flex;
            position: relatve;
            max-width: 100%;
            height: auto;
            width: 100%;
        }

        .upgrade-btn {
            width: auto;
            background: linear-gradient(140deg, rgb(222, 25, 250), rgb(17, 225, 225), rgb(110, 0, 159), rgba(255, 210, 254, 0.87), rgb(252, 47, 147));
            padding: 10px;
            border-radius: 15px;
            margin: 5px 10px auto;
            border: 4px outset transparent;
            color: #060101;
            text-decoration: none;
            font-size: 20px;
            font-weight: 790;
            text-shadow: 0 0 4px white;
        }

        .credits-btn {
            width: auto;
            background: linear-gradient(140deg, rgb(17, 225, 225), rgb(252, 47, 147), rgb(110, 0, 159), rgba(255, 210, 254, 0.87), rgb(222, 25, 250));
            padding: 10px;
            border-radius: 15px;
            margin: 4px 10px 10px;
            border: 5px outset transparent;
            color: #060101;
            text-decoration: none;
            font-size: 20px;
            font-weight: 790;
            text-shadow: 0 0 4px white;
            height: auto;
            max-width: 100vw;
        }

        label {
            font-size: 13px;
            color: var(--muted)
        }

        select,
        input[type="checkbox"] {
            accent-color: #7a5bff;
            border: 3px inset white;
            border-radius: 10px;
            padding: 5px;
            margin-top: 7px;
        }

        .btn {
            border: 0;
            border-radius: 14px;
            padding: 12px 14px;
            cursor: pointer;
            background: linear-gradient(381deg, rgba(252, 47, 147, 0.85), rgb(225, 225, 225), rgb(110, 0, 159), rgb(105, 128, 255), rgb(184, 31, 31));
            color: #fff;
            font-weight: 800;
            letter-spacing: .02em;
            box-shadow: 0 14px 30px rgba(120, 70, 255, .22);
        }

        .btn:disabled {
            border: 2px outset var(--stroke);
            opacity: .55;
            cursor: not-allowed;
            margin: 10px 10px 0px 0px;
        }

        .btn.secondary {
            background: linear-gradient(381deg, rgba(252, 47, 147, 0.85), rgb(225, 225, 225), rgb(110, 0, 159), rgb(105, 128, 255), rgb(184, 31, 31));
            border: 2px outset var(--stroke);
            color: rgba(255, 255, 255, 0.92);
            box-shadow: none;
            text-shadow: 0 0 1px white, 0 0 2px black, 0 0 3px black;
            border: 1px solid var(--stroke);
            color: var(--text);
            box-shadow: none;
        }

        .meta {
            font-size: 12.5px;
            color: var(--muted);
            line-height: 1.5
        }

        .preview {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 16px;
            background: radial-gradient(13% 100% at 50% 50%, rgb(24, 239, 239) 10%, rgb(110, 54, 210) 120%, rgb(223, 221, 121) 450%, rgb(201, 111, 111) 392%);
            padding: 4px;
            text-align: center;
            box-shadow: 0 0 7px 2px inset white;
            font-weight: 800;
            letter-spacing: 2px;
        }

        .kpis {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 10px;
            margin-top: 12px
        }

        .kpi {
            padding: 12px;
            border-radius: 16px;
            border: 2px outset rgba(255, 255, 255, .10);
            background: rgba(254, 253, 253, 0.2);
        }

        .kpi b {
            display: block;
            font-size: 13px
        }

        .kpi span {
            display: block;
            font-size: 12.5px;
            color: var(--muted);
            margin-top: 4px;
            word-break: break-word
        }

        footer {
            padding: 22px 0 40px;
            border-top: 1px solid rgba(255, 255, 255, .10);
            color: var(--muted)
        }

        code {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace
        }

        /* ===== FIX: lockup VOLYNX + ImageScaler sem alterar as cores do seu pill ===== */
        header {
            position: relative;
            z-index: 80;
        }

        .brand-logo {
            width: min(var(--max), 100%);
            margin: 0 auto;
            padding: 16px var(--pad) 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
            height: auto;
            /* mata 21vh */
        }

        /* mata o "right:-42vw" e "top:-vh" que quebram layout */
        .brand-logo img {
            position: static;
            right: auto;
            top: auto;

            max-width: clamp(150px, 16vw, 240px);
            width: auto;
            height: auto;
            background: none;
        }

        /* mantém seu pill, só remove o translate que desalinha */
        .pill {
            transform: none !important;
            left: auto !important;
            top: auto !important;
            margin-top: 2px;
        }

        /* seu brilho estava "position: relative" => não funciona como highlight por cima */
        .pill::before {
            position: absolute;
            /* <-- CRÍTICO */
            inset: auto;
            /* limpa o inset antigo */
            left: 12px;
            right: 12px;
            top: 10px;
            height: 42%;
            border-radius: 999px;
            pointer-events: none;
        }

        /* ===== FIX: lockup VOLYNX + ImageScaler sem alterar as cores do seu pill ===== */
        header {
            position: relative;
            z-index: 80;
        }

        .brand-logo {
            width: min(var(--max), 100%);
            margin: 0 auto;
            padding: 16px var(--pad) 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
            height: auto;
            /* mata 21vh */
        }

        /* mata o "right:-42vw" e "top:-vh" que quebram layout */
        .brand-logo img {
            position: static;
            right: auto;
            top: auto;

            max-width: clamp(150px, 16vw, 240px);
            width: auto;
            height: auto;
            background: none;
        }

        /* mantém seu pill, só remove o translate que desalinha */
        .pill {
            transform: none !important;
            left: auto !important;
            top: auto !important;
            margin-top: 2px;
        }

        /* seu brilho estava "position: relative" => não funciona como highlight por cima */
        .pill::before {
            position: absolute;
            /* <-- CRÍTICO */
            inset: auto;
            /* limpa o inset antigo */
            left: 12px;
            right: 12px;
            top: 10px;
            height: 42%;
            border-radius: 999px;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <header>
        <div class="brand-logo">
            <img src="../assets/new-wordmark.webp" alt="VOLYNX Lab logo" class="brand-logo-img" />
            <span class="pill">iMAGE.Scaler</span>
        </div>
    </header>

    <main>
        <div class="container">
            <section class="hero">
                <h1>Amplie imagens pequenas com qualidade</h1>
                <p>
                    Este MVP faz upscale local (browser) com suavização e nitidez opcional.
                    Para “AI upscale real” faça o UPGRADE do seu pacote na plataforma <strong>volynx.world</strong> ou
                    compre creditos
                    a vontade para usar como quiser!
                </p>
                <div class="upgrade-row">
                    <a class="upgrade-btn" href="/tools/image-scaler/upgrade/">Upgrade</a>
                    <a class="credits-btn" href="/tools/image-scaler/credits/">Buy Credits</a>

                </div>
            </section>

            <section class="grid">
                <div class="card">
                    <div class="cardHead">
                        <h2>Upload</h2>
                        <div class="row">
                            <button id="pickBtn" class="btn secondary" type="button">Selecionar arquivo</button>
                            <input id="file" type="file" accept="image/*" hidden />
                        </div>
                    </div>
                    <div class="cardBody">
                        <div id="drop" class="drop" role="button" tabindex="0"
                            aria-label="Arraste e solte a imagem aqui">
                            <div>
                                <div class="icon">☁︎</div>
                                <p><b>Arraste e solte</b> ou clique em “Selecionar arquivo”</p>
                                <p class="meta">Suporta PNG/JPG/WebP. Processamento local (não envia nada).</p>
                            </div>
                        </div>

                        <label for="mode">Modo</label>
                        <select id="mode">
                            <option value="local" selected>Rápido (local)</option>
                            <option value="ai">AI (beta)</option>
                        </select>


                        <div style="margin-top:14px" class="row">
                            <label for="scale">Escala</label>
                            <select id="scale">
                                <option value="2">2x</option>
                                <option value="3">3x</option>
                                <option value="4" selected>4x</option>
                            </select>

                            <label for="format">Formato</label>
                            <select id="format">
                                <option value="image/png" selected>PNG</option>
                                <option value="image/webp">WebP</option>
                                <option value="image/jpeg">JPG</option>
                            </select>

                            <label class="row" style="gap:8px">
                                <input id="sharpen" type="checkbox" checked />
                                Nitidez (sharpen)
                            </label>

                            <label class="row" style="gap:8px">
                                <input id="smooth" type="checkbox" checked />
                                Suavização alta
                            </label>

                            <button id="runBtn" class="btn" type="button" disabled>Gerar imagem</button>
                        </div>

                        <div class="kpis">
                            <div class="kpi"><b>Original</b><span id="origMeta">—</span></div>
                            <div class="kpi"><b>Saída</b><span id="outMeta">—</span></div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="cardHead">
                        <h2>Resultado</h2>
                        <div class="row">
                            <button id="downloadBtn" class="btn" type="button" disabled>Baixar</button>
                        </div>
                    </div>
                    <div class="cardBody">
                        <img id="preview" class="preview" alt="Prévia do resultado" />


                    </div>
                </div>
            </section>

            <footer>
                <div class="container" style="padding:0">

                </div>
            </footer>
        </div>
    </main>

    <script>
        const modeEl = $("mode");
        let srcFile = null;

        const $ = (id) => document.getElementById(id);

        const fileEl = $("file");
        const pickBtn = $("pickBtn");
        const dropEl = $("drop");
        const runBtn = $("runBtn");
        const downloadBtn = $("downloadBtn");
        const previewEl = $("preview");

        const scaleEl = $("scale");
        const fmtEl = $("format");
        const sharpenEl = $("sharpen");
        const smoothEl = $("smooth");

        const origMeta = $("origMeta");
        const outMeta = $("outMeta");

        let srcImg = null;
        let srcName = "image";
        let outBlob = null;
        let outW = 0, outH = 0;

        pickBtn.addEventListener("click", () => fileEl.click());
        dropEl.addEventListener("click", () => fileEl.click());
        dropEl.addEventListener("keydown", (e) => { if (e.key === "Enter" || e.key === " ") fileEl.click(); });

        fileEl.addEventListener("change", async () => {
            const f = fileEl.files && fileEl.files[0];
            if (!f) return;
            await loadFile(f);
        });

        ["dragenter", "dragover"].forEach(ev => {
            dropEl.addEventListener(ev, (e) => {
                e.preventDefault();
                dropEl.classList.add("drag");
            });
        });
        ["dragleave", "drop"].forEach(ev => {
            dropEl.addEventListener(ev, (e) => {
                e.preventDefault();
                dropEl.classList.remove("drag");
            });
        });
        dropEl.addEventListener("drop", async (e) => {
            const f = e.dataTransfer.files && e.dataTransfer.files[0];
            if (!f) return;
            await loadFile(f);
        });

        async function loadFile(file) {
            srcFile = file;
            srcName = (file.name || "image").replace(/\.[a-z0-9]+$/i, "");
            const url = URL.createObjectURL(file);

            const img = new Image();
            img.decoding = "async";
            img.src = url;

            await img.decode();
            URL.revokeObjectURL(url);

            srcImg = img;
            origMeta.textContent = `${img.naturalWidth}×${img.naturalHeight} • ${(file.size / 1024 / 1024).toFixed(2)}MB`;
            runBtn.disabled = false;
            downloadBtn.disabled = true;
            previewEl.removeAttribute("src");
            outMeta.textContent = "—";
            outBlob = null;
        }

        runBtn.addEventListener("click", async () => {
            if (!srcImg || !srcFile) return;

            runBtn.disabled = true;
            downloadBtn.disabled = true;
            runBtn.textContent = "Processando…";

            const mode = modeEl.value || "local";
            const scale = parseInt(scaleEl.value, 10) || 2;
            const mime = fmtEl.value || "image/png";
            const doSharpen = sharpenEl.checked;
            const hiSmooth = smoothEl.checked;

            try {
                let blob;

                if (mode === "ai") {
                    // AI: chama endpoint (proxy) — você pluga depois
                    blob = await upscaleAI({ file: srcFile, scale, mime });
                } else {
                    // Local: seu pipeline atual
                    const inW = srcImg.naturalWidth;
                    const inH = srcImg.naturalHeight;

                    outW = Math.max(1, Math.round(inW * scale));
                    outH = Math.max(1, Math.round(inH * scale));

                    const canvas = document.createElement("canvas");
                    canvas.width = outW;
                    canvas.height = outH;

                    const ctx = canvas.getContext("2d", { willReadFrequently: doSharpen });
                    ctx.imageSmoothingEnabled = true;
                    ctx.imageSmoothingQuality = hiSmooth ? "high" : "medium";
                    ctx.drawImage(srcImg, 0, 0, outW, outH);

                    if (doSharpen) {
                        try { applySharpen(ctx, outW, outH); } catch (e) { }
                    }

                    blob = await new Promise((resolve) => canvas.toBlob(resolve, mime, 0.95));
                }

                outBlob = blob;

                // pega dimensões reais do output (principalmente no AI)
                const bmp = await createImageBitmap(outBlob);
                outW = bmp.width;
                outH = bmp.height;

                const outUrl = URL.createObjectURL(outBlob);
                previewEl.src = outUrl;

                outMeta.textContent = `${outW}×${outH} • ${mime.replace("image/", "").toUpperCase()} • ${(outBlob.size / 1024 / 1024).toFixed(2)}MB`;
                downloadBtn.disabled = false;

            } catch (err) {
                alert(err?.message || "Falha ao processar.");
                outMeta.textContent = "—";
            } finally {
                runBtn.disabled = false;
                runBtn.textContent = "Gerar imagem";
            }
        });
        async function upscaleAI({ file, scale, mime }) {
            // endpoint que você vai criar (Cloudflare/Vercel/etc)
            const form = new FormData();
            form.append("file", file);
            form.append("scale", String(scale));
            form.append("mime", mime);

            const res = await fetch("/api/upscale", { method: "POST", body: form });
            if (!res.ok) {
                const t = await res.text().catch(() => "");
                throw new Error(t || "AI Upscale indisponível.");
            }
            return await res.blob();
        }


        downloadBtn.addEventListener("click", () => {
            if (!outBlob) return;

            const mime = fmtEl.value || "image/png";
            const ext = mime === "image/png" ? "png" : (mime === "image/webp" ? "webp" : "jpg");
            const a = document.createElement("a");
            a.href = URL.createObjectURL(outBlob);
            a.download = `${srcName}-${outW}x${outH}.${ext}`;
            document.body.appendChild(a);
            a.click();
            a.remove();
            setTimeout(() => URL.revokeObjectURL(a.href), 1200);
        });

        function applySharpen(ctx, w, h) {
            // kernel sharpen 3x3: [0 -1 0; -1 5 -1; 0 -1 0]
            const imgData = ctx.getImageData(0, 0, w, h);
            const src = imgData.data;
            const out = new Uint8ClampedArray(src.length);

            const k = [0, -1, 0, -1, 5, -1, 0, -1, 0];

            const idx = (x, y) => (y * w + x) * 4;

            for (let y = 1; y < h - 1; y++) {
                for (let x = 1; x < w - 1; x++) {
                    let r = 0, g = 0, b = 0, a = 0;
                    let ki = 0;
                    for (let j = -1; j <= 1; j++) {
                        for (let i = -1; i <= 1; i++) {
                            const p = idx(x + i, y + j);
                            const kv = k[ki++];
                            r += src[p] * kv;
                            g += src[p + 1] * kv;
                            b += src[p + 2] * kv;
                            a += src[p + 3]; // alpha sem sharpen agressivo
                        }
                    }
                    const p0 = idx(x, y);
                    out[p0] = clamp(r);
                    out[p0 + 1] = clamp(g);
                    out[p0 + 2] = clamp(b);
                    out[p0 + 3] = clamp(a / 9);
                }
            }

            // bordas: copia
            for (let x = 0; x < w; x++) {
                copyPx(src, out, idx(x, 0));
                copyPx(src, out, idx(x, h - 1));
            }
            for (let y = 0; y < h; y++) {
                copyPx(src, out, idx(0, y));
                copyPx(src, out, idx(w - 1, y));
            }

            imgData.data.set(out);
            ctx.putImageData(imgData, 0, 0);
        }

        function copyPx(src, out, p) {
            out[p] = src[p]; out[p + 1] = src[p + 1]; out[p + 2] = src[p + 2]; out[p + 3] = src[p + 3];
        }
        function clamp(v) { return v < 0 ? 0 : (v > 255 ? 255 : v); }
    </script>
</body>

</html>
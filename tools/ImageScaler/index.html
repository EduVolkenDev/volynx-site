<!doctype html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="theme-color" content="#080610" />
    <title>VOLYNX • ImageScaler</title>
    <style>
        /* ========================================
           MOBILE-FIRST CSS VARIABLES
        ======================================== */
        :root {
            --bg0: #080610;
            --bg1: #0b0720;
            --text: rgba(255, 255, 255, .92);
            --muted: rgba(255, 255, 255, .68);
            --stroke: rgba(255, 255, 255, .14);
            --card: rgba(255, 255, 255, .06);
            --card2: rgba(255, 255, 255, .04);
            --shadow: 0 18px 42px rgba(0, 0, 0, .35);
            --r: clamp(12px, 3vw, 22px);
            --pad: clamp(16px, 4vw, 32px);
            --max: 1120px;
            --btn: linear-gradient(90deg, rgba(49, 81, 255, .95), rgba(190, 45, 255, .85));
            --gap: clamp(12px, 2.5vw, 20px);
        }

        /* ========================================
           RESET & BASE (MOBILE-FIRST)
        ======================================== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            height: 100%;
            overflow-x: hidden;
            overflow-y: auto;
        }

        body {
            min-height: 100%;
            margin: 0;
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
            color: var(--text);
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: "";
            position: fixed;
            inset: 0;
            pointer-events: none;
            background: url("assets/lucid4.jpg") center/cover;
            z-index: -1;
        }

        /* ========================================
           HEADER & BRANDING (MOBILE-FIRST)
        ======================================== */
        header {
            position: relative;
            z-index: 80;
            width: 100%;
        }

        .brand-logo {
            width: 100%;
            max-width: var(--max);
            margin: 0 auto;
            padding: clamp(12px, 3vw, 20px) var(--pad);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: clamp(8px, 2vw, 12px);
        }

        .brand-logo img {
            max-width: clamp(140px, 50vw, 240px);
            width: auto;
            height: auto;
        }

        /* PILL - Responsivo Mobile-First */
        .pill {
            position: relative;
            display: inline-block;
            font-weight: 490;
            letter-spacing: 0.02em;
            font-size: clamp(24px, 6vw, 65px);
            line-height: 1;
            color: #f602d0;
            background: linear-gradient(381deg, rgba(252, 47, 147, 0.85), rgb(225, 225, 225), rgb(110, 0, 159), rgb(105, 128, 255), rgb(184, 31, 31));
            border: clamp(8px, 2vw, 31px) outset rgba(255, 255, 255, 0.2);
            box-shadow:
                0 0px 14px clamp(20px, 10vw, 82px) inset rgba(165, 75, 255, 0.52),
                clamp(10px, 5vw, 30px) clamp(8px, 4vw, 20px) clamp(12px, 6vw, 30px) clamp(4px, 2vw, 10px) rgb(0, 207, 255) inset,
                0 clamp(8px, 4vw, 20px) clamp(12px, 6vw, 32px) clamp(4px, 2vw, 10px) rgb(151, 0, 255) inset,
                clamp(4px, 2vw, 10px) clamp(-12px, -6vw, -34px) clamp(24px, 12vw, 64px) 1px rgb(9, 3, 19) inset,
                0 0 clamp(32px, 16vw, 86px) inset rgb(193, 35, 35);
            border-radius: clamp(40px, 15vw, 100px);
            border-top-left-radius: 0px;
            padding: clamp(8px, 2vw, 15px) clamp(12px, 3vw, 20px);
            text-shadow: 0 0 10px white;
            width: auto;
            min-width: clamp(180px, 40vw, 280px);
            text-align: center;
        }

        .pill::before {
            content: "";
            position: absolute;
            left: clamp(6px, 2vw, 12px);
            right: clamp(6px, 2vw, 12px);
            top: clamp(4px, 2vw, 10px);
            height: 42%;
            border-radius: 999px;
            background: linear-gradient(381deg, rgba(252, 47, 147, 0.85), rgb(225, 225, 225), rgb(110, 0, 159), rgb(222, 25, 250), rgb(184, 31, 31));
            opacity: .75;
            filter: blur(.2px);
            pointer-events: none;
        }

        /* ========================================
           MAIN CONTAINER (MOBILE-FIRST)
        ======================================== */
        .container {
            width: 100%;
            max-width: var(--max);
            margin: 0 auto;
            padding: 0 var(--pad);
            display: flex;
            flex-direction: column;
            gap: var(--gap);
        }

        main {
            padding: clamp(16px, 4vw, 26px) 0 clamp(20px, 5vw, 40px);
        }

        /* ========================================
           HERO SECTION (MOBILE-FIRST)
        ======================================== */
        .hero {
            width: 100%;
            padding: 0;
            margin: 0 0 clamp(16px, 4vw, 24px) 0;
        }

        .hero h1 {
            margin: 0 0 clamp(12px, 3vw, 16px);
            font-size: clamp(20px, 5vw, 46px);
            letter-spacing: -0.02em;
            line-height: 1.3;
            background: rgba(91, 91, 91, 0.55);
            border-radius: clamp(12px, 3vw, 20px);
            padding: clamp(12px, 3vw, 18px);
            backdrop-filter: blur(15px);
            box-shadow: 0 0 3px inset aqua;
            text-align: center;
            text-shadow: 0 0 8px aqua;
        }

        .hero p {
            margin: 0 0 clamp(12px, 3vw, 16px);
            color: rgba(253, 248, 248, 0.68);
            line-height: 1.6;
            font-size: clamp(14px, 3.5vw, 16px);
            background: rgba(91, 91, 91, 0.55);
            backdrop-filter: blur(20px);
            border-radius: clamp(12px, 3vw, 20px);
            padding: clamp(12px, 3vw, 18px);
            box-shadow: 0 0 3px inset #2dffff;
            text-align: center;
            text-shadow: 0 0 8px aqua;
        }

        strong {
            text-shadow: 0 0 2px rgb(115, 0, 247);
        }

        /* ========================================
           UPGRADE BUTTONS (MOBILE-FIRST)
        ======================================== */
        .upgrade-row {
            display: flex;
            flex-direction: column;
            gap: clamp(8px, 2vw, 12px);
            width: 100%;
        }

        .upgrade-btn,
        .credits-btn {
            width: 100%;
            padding: clamp(12px, 3vw, 16px) clamp(16px, 4vw, 24px);
            border-radius: clamp(10px, 2.5vw, 15px);
            border: none;
            color: #060101;
            text-decoration: none;
            font-size: clamp(16px, 4vw, 20px);
            font-weight: 790;
            text-shadow: 0 0 4px white;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            min-height: 44px;
            /* Touch-friendly */
        }

        .upgrade-btn {
            background: linear-gradient(140deg, rgb(222, 25, 250), rgb(17, 225, 225), rgb(110, 0, 159), rgba(255, 210, 254, 0.87), rgb(252, 47, 147));
        }

        .credits-btn {
            background: linear-gradient(140deg, rgb(17, 225, 225), rgb(252, 47, 147), rgb(110, 0, 159), rgba(255, 210, 254, 0.87), rgb(222, 25, 250));
        }

        .upgrade-btn:hover,
        .credits-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(120, 70, 255, .4);
        }

        .upgrade-btn:active,
        .credits-btn:active {
            transform: translateY(0);
        }

        /* ========================================
           GRID & CARDS (MOBILE-FIRST)
        ======================================== */
        .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: clamp(16px, 4vw, 24px);
            width: 100%;
        }

        .card {
            border: 1px solid var(--stroke);
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.49), rgba(35, 239, 201, 0.13));
            border-radius: var(--r);
            box-shadow: var(--shadow);
            overflow: hidden;
            backdrop-filter: blur(30px);
            width: 100%;
            height: auto;
        }

        .cardHead {
            padding: clamp(12px, 3vw, 18px);
            border-bottom: 2px solid rgba(255, 255, 255, 0.44);
            display: flex;
            flex-direction: column;
            align-items: stretch;
            gap: clamp(8px, 2vw, 12px);
            min-height: auto;
        }

        .cardHead h2 {
            margin: 0;
            font-size: clamp(18px, 4.5vw, 25px);
            letter-spacing: 0.08em;
            font-weight: 850;
        }

        .cardBody {
            padding: clamp(12px, 3vw, 20px);
        }

        /* ========================================
           DROP ZONE (MOBILE-FIRST)
        ======================================== */
        .drop {
            border: 2px dashed rgba(9, 255, 243, 0.6);
            border-radius: clamp(12px, 3vw, 18px);
            min-height: clamp(140px, 30vw, 185px);
            display: flex;
            place-items: center;
            justify-content: center;
            text-align: center;
            background: rgba(0, 0, 0, .18);
            flex-direction: column;
            padding: clamp(16px, 4vw, 24px);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .drop.drag {
            border-color: rgba(255, 255, 255, .5);
            background: rgba(80, 120, 255, .10);
        }

        .drop .icon {
            font-size: clamp(32px, 8vw, 48px);
            opacity: .9;
        }

        .drop p {
            margin: clamp(8px, 2vw, 12px) 0 0;
            color: var(--muted);
            font-size: clamp(13px, 3.5vw, 15px);
        }

        /* ========================================
           CONTROLS & INPUTS (MOBILE-FIRST)
        ======================================== */
        .row {
            display: flex;
            gap: clamp(8px, 2vw, 12px);
            flex-wrap: wrap;
            align-items: center;
        }

        label {
            font-size: clamp(12px, 3vw, 14px);
            color: var(--muted);
            display: block;
            margin-bottom: 4px;
        }

        select,
        input[type="number"],
        input[type="text"] {
            width: 100%;
            padding: clamp(10px, 2.5vw, 14px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: clamp(8px, 2vw, 12px);
            background: rgba(0, 0, 0, 0.3);
            color: var(--text);
            font-size: clamp(14px, 3.5vw, 16px);
            transition: border-color 0.2s ease;
            min-height: 44px;
            /* Touch-friendly */
        }

        select:focus,
        input[type="number"]:focus,
        input[type="text"]:focus {
            outline: none;
            border-color: rgba(122, 91, 255, 0.8);
        }

        input[type="checkbox"] {
            width: clamp(18px, 4vw, 22px);
            height: clamp(18px, 4vw, 22px);
            accent-color: #7a5bff;
            cursor: pointer;
        }

        /* ========================================
           BUTTONS (MOBILE-FIRST)
        ======================================== */
        .btn {
            padding: clamp(12px, 3vw, 16px) clamp(20px, 5vw, 32px);
            border: none;
            border-radius: clamp(10px, 2.5vw, 14px);
            background: var(--btn);
            color: white;
            font-size: clamp(14px, 3.5vw, 16px);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(120, 70, 255, .3);
            min-height: 44px;
            /* Touch-friendly */
            width: 100%;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(120, 70, 255, .5);
        }

        .btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn.secondary:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.15);
        }

        /* ========================================
           KPIs (MOBILE-FIRST)
        ======================================== */
        .kpis {
            display: flex;
            flex-direction: column;
            gap: clamp(8px, 2vw, 12px);
            margin-top: clamp(16px, 4vw, 20px);
            width: 100%;
        }

        .kpi {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: clamp(10px, 2.5vw, 14px);
            background: rgba(0, 0, 0, 0.2);
            border-radius: clamp(8px, 2vw, 12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .kpi b {
            font-size: clamp(11px, 2.8vw, 13px);
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .kpi span {
            font-size: clamp(13px, 3.2vw, 15px);
            color: var(--text);
        }

        /* ========================================
           PREVIEW (MOBILE-FIRST)
        ======================================== */
        .preview {
            width: 100%;
            height: auto;
            max-width: 100%;
            border-radius: clamp(8px, 2vw, 12px);
            display: block;
            background: rgba(0, 0, 0, 0.2);
            min-height: clamp(120px, 25vw, 200px);
        }

        .preview:not([src]) {
            opacity: 0.3;
        }

        /* ========================================
           META TEXT
        ======================================== */
        .meta {
            font-size: clamp(11px, 2.8vw, 13px);
            color: rgba(255, 255, 255, 0.5);
            margin-top: 4px;
        }

        /* ========================================
           FOOTER (MOBILE-FIRST)
        ======================================== */
        footer {
            padding: clamp(20px, 5vw, 40px) 0;
            text-align: center;
            color: var(--muted);
            font-size: clamp(12px, 3vw, 14px);
        }

        /* ========================================
           TABLET BREAKPOINT (768px+)
        ======================================== */
        @media (min-width: 768px) {
            .brand-logo {
                flex-direction: row;
                justify-content: space-between;
                gap: clamp(16px, 3vw, 24px);
            }

            .upgrade-row {
                flex-direction: row;
            }

            .upgrade-btn,
            .credits-btn {
                width: auto;
                flex: 1;
            }

            .grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .cardHead {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }

            .row {
                flex-wrap: nowrap;
            }

            .btn {
                width: auto;
            }

            .kpis {
                flex-direction: row;
            }

            .kpi {
                flex: 1;
            }
        }

        /* ========================================
           DESKTOP BREAKPOINT (1024px+)
        ======================================== */
        @media (min-width: 1024px) {
            .hero h1 {
                font-size: clamp(36px, 4vw, 46px);
            }

            .hero p {
                font-size: 16px;
            }

            .pill {
                font-size: clamp(50px, 5vw, 65px);
            }

            .cardHead h2 {
                font-size: 25px;
            }

            .drop {
                min-height: 185px;
            }

            .drop .icon {
                font-size: 48px;
            }

            .drop p {
                font-size: 15px;
            }
        }

        /* ========================================
           LARGE DESKTOP (1440px+)
        ======================================== */
        @media (min-width: 1440px) {
            :root {
                --pad: 40px;
                --gap: 24px;
            }
        }
    </style>
</head>
aria-label="Arraste e solte a imagem aqui"><div>
    <div class="icon">☁︎</div>
    <p><b>Arraste e solte</b>ou clique em “Selecionar arquivo”</p>
    <p class="meta">Suporta PNG/JPG/WebP. Processamento local (não envia nada).</p>
</div>
</div><label for="mode">Modo</label><select id="mode">
    <option value="local" selected>Rápido (local)</option>
    <option value="ai">AI (beta)</option>
</select>
<div style="margin-top:14px" class="row"><label for="scale">Escala</label><select id="scale">
        <option value="2">2x</option>
        <option value="3">3x</option>
        <option value="4" selected>4x</option>
    </select><label for="format">Formato</label><select id="format">
        <option value="image/png" selected>PNG</option>
        <option value="image/webp">WebP</option>
        <option value="image/jpeg">JPG</option>
    </select><label class="row" style="gap:8px"><input id="sharpen" type="checkbox" checked />Nitidez (sharpen)
    </label><label class="row" style="gap:8px"><input id="smooth" type="checkbox" checked />Suavização alta
    </label><button id="runBtn" class="btn" type="button" disabled>Gerar imagem</button></div>
<div class="kpis">
    <div class="kpi"><b>Original</b><span id="origMeta">—</span></div>
    <div class="kpi"><b>Saída</b><span id="outMeta">—</span></div>
</div>
</div>
</div>
<div class="card">
    <div class="cardHead">
        <h2>Resultado</h2>
        <div class="row"><button id="downloadBtn" class="btn" type="button" disabled>Baixar</button></div>
    </div>
    <div class="cardBody"><img id="preview" class="preview" alt="Prévia do resultado" /></div>
</div>
</section>
<footer>
    <div class="container" style="padding:0"></div>
</footer>
</div>
</main>
<script> // ✅ CORREÇÃO: Declarar $ PRIMEIRO, antes de usar
    const $ = (id) => document.getElementById(id);

    const modeEl = $("mode");
    let srcFile = null;

    const fileEl = $("file");
    const pickBtn = $("pickBtn");
    const dropEl = $("drop");
    const runBtn = $("runBtn");
    const downloadBtn = $("downloadBtn");
    const previewEl = $("preview");

    const scaleEl = $("scale");
    const fmtEl = $("format");
    const sharpenEl = $("sharpen");
    const smoothEl = $("smooth");

    const origMeta = $("origMeta");
    const outMeta = $("outMeta");

    let srcImg = null;
    let srcName = "image";
    let outBlob = null;
    let outW = 0,
        outH = 0;

    pickBtn.addEventListener("click", () => fileEl.click());
    dropEl.addEventListener("click", () => fileEl.click());

    dropEl.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") fileEl.click();
    });

    fileEl.addEventListener("change", async () => {
        const f = fileEl.files && fileEl.files[0];
        if (!f) return;
        await loadFile(f);
    });

    ["dragenter",
        "dragover"].forEach(ev => {
            dropEl.addEventListener(ev, (e) => {
                e.preventDefault();
                dropEl.classList.add("drag");
            });
        });

    ["dragleave",
        "drop"].forEach(ev => {
            dropEl.addEventListener(ev, (e) => {
                e.preventDefault();
                dropEl.classList.remove("drag");
            });
        });

    dropEl.addEventListener("drop", async (e) => {
        const f = e.dataTransfer.files && e.dataTransfer.files[0];
        if (!f) return;
        await loadFile(f);
    });

    async function loadFile(file) {
        srcFile = file;
        srcName = (file.name || "image").replace(/\.[a-z0-9]+$/i, "");
        const url = URL.createObjectURL(file);

        const img = new Image();
        img.decoding = "async";
        img.src = url;

        await img.decode();
        URL.revokeObjectURL(url);

        srcImg = img;

        origMeta.textContent = `$ {
                    img.naturalWidth
                }

                ×$ {
                    img.naturalHeight
                }

                • $ {
                    (file.size / 1024 / 1024).toFixed(2)
                }

                MB`;
        runBtn.disabled = false;
        downloadBtn.disabled = true;
        previewEl.removeAttribute("src");
        outMeta.textContent = "—";
        outBlob = null;
    }

    runBtn.addEventListener("click", async () => {
        if (!srcImg || !srcFile) return;

        runBtn.disabled = true;
        downloadBtn.disabled = true;
        runBtn.textContent = "Processando…";

        const mode = modeEl.value || "local";
        const scale = parseInt(scaleEl.value, 10) || 2;
        const mime = fmtEl.value || "image/png";
        const doSharpen = sharpenEl.checked;
        const hiSmooth = smoothEl.checked;

        try {
            let blob;

            if (mode === "ai") {

                // AI: chama endpoint (proxy) — você pluga depois
                blob = await upscaleAI({
                    file: srcFile, scale, mime
                });
            }

            else {
                // Local: seu pipeline atual
                const inW = srcImg.naturalWidth;
                const inH = srcImg.naturalHeight;

                outW = Math.max(1, Math.round(inW * scale));
                outH = Math.max(1, Math.round(inH * scale));

                const canvas = document.createElement("canvas");
                canvas.width = outW;
                canvas.height = outH;

                const ctx = canvas.getContext("2d", {
                    willReadFrequently: doSharpen
                });
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = hiSmooth ? "high" : "medium";
                ctx.drawImage(srcImg, 0, 0, outW, outH);

                if (doSharpen) {
                    try {
                        applySharpen(ctx, outW, outH);
                    }

                    catch (e) { }
                }

                blob = await new Promise((resolve) => canvas.toBlob(resolve, mime, 0.95));
            }

            outBlob = blob;

            // pega dimensões reais do output (principalmente no AI)
            const bmp = await createImageBitmap(outBlob);
            outW = bmp.width;
            outH = bmp.height;

            const outUrl = URL.createObjectURL(outBlob);
            previewEl.src = outUrl;

            outMeta.textContent = `$ {
                    outW
                }

                ×$ {
                    outH
                }

                • $ {
                    mime.replace("image/", "").toUpperCase()
                }

                • $ {
                    (outBlob.size / 1024 / 1024).toFixed(2)
                }

                MB`;
            downloadBtn.disabled = false;

        }

        catch (err) {
            alert(err?.message || "Falha ao processar.");
            outMeta.textContent = "—";
        }

        finally {
            runBtn.disabled = false;
            runBtn.textContent = "Gerar imagem";
        }
    });

    async function upscaleAI({
        file, scale, mime

    }) {
        // endpoint que você vai criar (Cloudflare/Vercel/etc)
        const form = new FormData();
        form.append("file", file);
        form.append("scale", String(scale));
        form.append("mime", mime);

        const res = await fetch("/api/upscale", {
            method: "POST", body: form
        });

        if (!res.ok) {
            const t = await res.text().catch(() => "");
            throw new Error(t || "AI Upscale indisponível.");
        }

        return await res.blob();
    }


    downloadBtn.addEventListener("click", () => {
        if (!outBlob) return;

        const mime = fmtEl.value || "image/png";
        const ext = mime === "image/png" ? "png" : (mime === "image/webp" ? "webp" : "jpg");
        const a = document.createElement("a");
        a.href = URL.createObjectURL(outBlob);

        a.download = `$ {
                    srcName
                }

                -$ {
                    outW
                }

                x$ {
                    outH
                }

                .$ {
                    ext
                }

                `;
        document.body.appendChild(a);
        a.click();
        a.remove();
        setTimeout(() => URL.revokeObjectURL(a.href), 1200);
    });

    function applySharpen(ctx, w, h) {
        // kernel sharpen 3x3: [0 -1 0; -1 5 -1; 0 -1 0]
        const imgData = ctx.getImageData(0, 0, w, h);
        const src = imgData.data;
        const out = new Uint8ClampedArray(src.length);

        const k = [0,
            -1,
            0,
            -1,
            5,
            -1,
            0,
            -1,
            0];

        const idx = (x, y) => (y * w + x) * 4;

        for (let y = 1; y < h - 1; y++) {
            for (let x = 1; x < w - 1; x++) {
                let r = 0,
                    g = 0,
                    b = 0,
                    a = 0;
                let ki = 0;

                for (let j = -1; j <= 1; j++) {
                    for (let i = -1; i <= 1; i++) {
                        const p = idx(x + i, y + j);
                        const kv = k[ki++];
                        r += src[p] * kv;
                        g += src[p + 1] * kv;
                        b += src[p + 2] * kv;
                        a += src[p + 3]; // alpha sem sharpen agressivo
                    }
                }

                const p0 = idx(x, y);
                out[p0] = clamp(r);
                out[p0 + 1] = clamp(g);
                out[p0 + 2] = clamp(b);
                out[p0 + 3] = clamp(a / 9);
            }
        }

        // bordas: copia
        for (let x = 0; x < w; x++) {
            copyPx(src, out, idx(x, 0));
            copyPx(src, out, idx(x, h - 1));
        }

        for (let y = 0; y < h; y++) {
            copyPx(src, out, idx(0, y));
            copyPx(src, out, idx(w - 1, y));
        }

        imgData.data.set(out);
        ctx.putImageData(imgData, 0, 0);
    }

    function copyPx(src, out, p) {
        out[p] = src[p];
        out[p + 1] = src[p + 1];
        out[p + 2] = src[p + 2];
        out[p + 3] = src[p + 3];
    }

    function clamp(v) {
        return v < 0 ? 0 : (v > 255 ? 255 : v);
    }

</script>
</body>

</html>